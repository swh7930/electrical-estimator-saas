{% extends "base.html" %}
{% block title %}Billing{% endblock %}

{% block content %}
<div class="container-xxl my-4">
  <div class="row">
    <div class="col">
      <h1 class="h3 mb-3">Billing</h1>
      {% if is_active %}
        <div class="alert alert-success mb-4" role="alert">
          Your organization has an active subscription.
        </div>
        <form action="{{ url_for('billing.portal') }}" method="post" class="d-inline">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="btn btn-primary">Open Customer Portal</button>
        </form>
        <p class="text-muted mt-2 mb-0">Manage payment methods, change plan, or cancel anytime in the Customer Portal.</p>
      {% else %}
        <div class="row g-3">
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h2 class="h5">Pro — Monthly</h2>
                <p class="text-muted mb-4">All current features. Billed monthly. Taxes added at checkout.</p>
                <form action="{{ url_for('billing.checkout') }}" method="post" class="mt-auto">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="price_id" value="{{ price_pro_monthly }}">
                  <button class="btn btn-primary" type="submit" {% if not price_pro_monthly %}disabled{% endif %}>
                    Subscribe Monthly
                  </button>
                </form>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h2 class="h5">Pro — Annual</h2>
                <p class="text-muted mb-4">All current features. Billed annually. Taxes added at checkout.</p>
                <form action="{{ url_for('billing.checkout') }}" method="post" class="mt-auto">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="price_id" value="{{ price_pro_annual }}">
                  <button class="btn btn-outline-primary" type="submit" {% if not price_pro_annual %}disabled{% endif %}>
                    Subscribe Annually
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>

        {% if price_elite_monthly or price_elite_annual %}
        <hr class="my-4">
        <h2 class="h5 mb-3">Elite (Future)</h2>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h3 class="h6">Elite — Monthly</h3>
                <p class="text-muted mb-4">Advanced capabilities planned.</p>
                <form action="{{ url_for('billing.checkout') }}" method="post" class="mt-auto">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="price_id" value="{{ price_elite_monthly }}">
                  <button class="btn btn-secondary" type="submit" {% if not price_elite_monthly %}disabled{% endif %}>
                    Subscribe (Monthly)
                  </button>
                </form>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h3 class="h6">Elite — Annual</h3>
                <p class="text-muted mb-4">Advanced capabilities planned.</p>
                <form action="{{ url_for('billing.checkout') }}" method="post" class="mt-auto">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="price_id" value="{{ price_elite_annual }}">
                  <button class="btn btn-secondary" type="submit" {% if not price_elite_annual %}disabled{% endif %}>
                    Subscribe (Annual)
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
  {{ super() }}
  <script src="https://js.stripe.com/v3"></script>
  <script src="{{ url_for('static', filename='js/billing.js') }}"></script>
{% endblock %}