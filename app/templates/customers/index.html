{% extends "base.html" %}
{% block title %}Customers · Electrical Estimator{% endblock %}
{% block container_class %}container-xxl{% endblock %}
{% block content %}

  <div id="customers-grid" class="row g-4">
    <div class="col-12">

      <header class="text-center border-bottom py-3 mb-3">
        <div>
          <h1 class="h3 mb-1">Customers</h1>
          <div class="text-muted">Add new customers and manage your customer list.</div>
        </div>
      </header>

      <div class="mb-2">
        <a href="{{ url_for('main.home') }}"
          id="customersBackLink"
          class="btn btn-link p-0">
          &larr; Back to Home
        </a>
      </div>

      <!-- Inline Add (visual-only; mirrors Materials/DJE pattern) -->
      <section id="customers-inline-add" class="card p-3 mb-3">
        <form class="row g-3 align-items-end" onsubmit="return false;">
          <div class="col-12 col-lg-4">
            <label class="form-label" for="cust-add-name">Customer Name</label>
            <input id="cust-add-name" type="text" class="form-control" placeholder="e.g., ACME Construction">
          </div>
          <div class="col-12 col-lg-4">
            <label class="form-label" for="cust-add-contact">Primary Contact</label>
            <input id="cust-add-contact" type="text" class="form-control" placeholder="e.g., Jane Doe">
          </div>
          <div class="col-12 col-lg-4">
            <label class="form-label" for="cust-add-email">Email</label>
            <input id="cust-add-email" type="email" class="form-control" placeholder="name@company.com">
          </div>

          <div class="col-12 col-lg-4">
            <label class="form-label" for="cust-add-phone">Phone</label>
            <input id="cust-add-phone" type="tel" class="form-control" placeholder="(555) 123-4567">
          </div>
          <div class="col-12 col-lg-8">
            <label class="form-label" for="cust-add-address">Address</label>
            <input id="cust-add-address" type="text" class="form-control" placeholder="Street, City, State ZIP">
          </div>

          <div class="col-12">
            <label class="form-label" for="cust-add-notes">Notes</label>
            <textarea id="cust-add-notes" class="form-control" rows="1" placeholder="Optional notes"></textarea>
          </div>

          <div class="col-12 d-flex gap-2">
            <button id="cust-add-submit" type="button" class="btn btn-primary">Add</button>
            <button id="cust-add-reset" type="button" class="btn btn-outline-secondary">Reset</button>
          </div>
        </form>
      </section>

      <!-- Filters (card-wrapped to match Libraries rhythm) -->
      <section id="customers-filters" class="card p-3 mb-3">
        <form method="get" action="" class="row g-3 align-items-end">
          <div class="col-12 col-md-4">
            <label class="form-label" for="cust-filter-q">Search</label>
            <input id="cust-filter-q" type="text" name="q" class="form-control" placeholder="Name, contact, email…" value="{{ q or '' }}">
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label" for="cust-filter-city">City</label>
            <input id="cust-filter-city" type="text" name="city" class="form-control" placeholder="Filter by city" value="{{ city_filter or '' }}">
          </div>
          <div class="col-12 col-md-4 d-flex gap-2">
            <button class="btn btn-outline-primary mt-auto" type="submit">Apply</button>
            <a id="cust-filter-reset" class="btn btn-outline-secondary mt-auto" href="{{ url_for('libraries.customers') }}">Reset</a>
          </div>
        </form>
      </section>

      <!-- Table (card-wrapped; same density as Materials/DJE) -->
      <section class="card">
        <table id="customers-table" class="table table-sm table-hover align-middle mb-0">
          <thead>
            <tr>
              <th scope="col">Customer</th>
              <th scope="col">Primary Contact</th>
              <th scope="col">Email</th>
              <th scope="col">Phone</th>
              <th scope="col">City</th>
              <th scope="col" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if customers %}
              {% for c in customers %}
                <tr data-customer-id="{{ c.id }}">
                  <td>{{ c.name }}</td>
                  <td>{{ c.primary_contact or '' }}</td>
                  <td>{{ c.email or '' }}</td>
                  <td>{{ c.phone or '' }}</td>
                  <td>{{ c.city or '' }}</td>
                  <td class="text-end">
                    <button
                      type="button"
                      class="btn btn-sm btn-outline-primary"
                      data-action="edit-customer"
                      data-customer-id="{{ c.id }}"
                      data-name="{{ c.name }}"
                      data-contact="{{ c.primary_contact or '' }}"
                      data-email="{{ c.email or '' }}"
                      data-phone="{{ c.phone or '' }}"
                      data-address="{{ c.address or '' }}"
                      data-city="{{ c.city or '' }}"
                      data-notes="{{ c.notes or '' }}"
                      data-bs-toggle="modal"
                      data-bs-target="#mdlEditCustomer"
                    >Edit</button>
                    <button
                      type="button"
                      class="btn btn-sm btn-outline-danger"
                      data-action="delete-customer"
                      data-customer-id="{{ c.id }}"
                      data-name="{{ c.name }}"
                      data-bs-toggle="modal"
                      data-bs-target="#mdlDeleteCustomer"
                    >Delete</button>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="6" class="text-muted fst-italic">No customers yet.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </section>

      <!-- Modals (visual-only stubs) -->
      <div class="modal fade" id="mdlEditCustomer" tabindex="-1" aria-labelledby="mdlEditCustomerLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 id="mdlEditCustomerLabel" class="modal-title">Edit Customer</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form class="row g-3">
                <div class="col-12 col-lg-6">
                  <label class="form-label" for="cust-modal-name">Customer Name</label>
                  <input id="cust-modal-name" type="text" class="form-control" value="ACME Construction">
                </div>
                <div class="col-12 col-lg-6">
                  <label class="form-label" for="cust-modal-contact">Primary Contact</label>
                  <input id="cust-modal-contact" type="text" class="form-control" value="Jane Doe">
                </div>
                <div class="col-12 col-lg-6">
                  <label class="form-label" for="cust-modal-email">Email</label>
                  <input id="cust-modal-email" type="email" class="form-control" value="jane@acme.example">
                </div>
                <div class="col-12 col-lg-6">
                  <label class="form-label" for="cust-modal-phone">Phone</label>
                  <input id="cust-modal-phone" type="tel" class="form-control" value="(555) 123-4567">
                </div>
                <div class="col-12">
                  <label class="form-label" for="cust-modal-address">Address</label>
                  <input id="cust-modal-address" type="text" class="form-control" value="123 Main St, Tulsa, OK 74101">
                </div>
                <div class="col-12">
                  <label class="form-label" for="cust-modal-notes">Notes</label>
                  <textarea id="cust-modal-notes" class="form-control" rows="3"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button id="cust-modal-save" class="btn btn-primary" type="button">Save</button>
              <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="mdlDeleteCustomer" tabindex="-1" aria-labelledby="mdlDeleteCustomerLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <h6 id="mdlDeleteCustomerLabel" class="modal-title">Delete Customer</h6>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete this customer? <strong id="cust-delete-name"></strong>?
            </div>
            <div class="modal-footer">
              <button id="cust-delete-confirm" class="btn btn-danger" type="button">Delete</button>
              <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
{% endblock %}
{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/notify.js') }}"></script>
  <script src="{{ url_for('static', filename='js/validation.js') }}"></script>
  <script src="{{ url_for('static', filename='js/customers_index.js') }}"></script>
{% endblock %}
