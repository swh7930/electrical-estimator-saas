{% extends "base.html" %}
{% block title %}Instructions{% endblock %}
{% block container_class %}container-xxl{% endblock %}

{% block content %}
<div id="instructions-grid" class="row g-4">

  <!-- Page Header -->
  <div class="col-12">
    <header class="text-center border-bottom py-3 mb-3">
      <div>
        <h1 class="h3 mb-1">Instructions</h1>
        <div class="text-muted">How to build fast, consistent estimates and export clean outputs.</div>
        <div class="text-muted small mt-1">Last updated: October 24, 2025 · Need help? Email <a href="mailto:support@electriciansmentor.com">support@electriciansmentor.com</a>.</div>
      </div>
    </header>
  </div>

  <!-- Quick Start / TOC -->
  <div class="col-12">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Quick Start</h2>
        <ol class="mb-2">
          <li>Open <strong>Admin → Settings</strong> and enter company details and estimator defaults (labor rate, overhead, margin, tax).</li>
          <li>Review <strong>Libraries → Materials / DJE / Assemblies / Customers</strong> and add anything you’ll need.</li>
          <li>Go to <strong>Estimates → New Estimate</strong> and fill in project info.</li>
          <li>Work through <strong>Materials → Adjustments → DJE → Summary</strong>.</li>
          <li><strong>Save</strong> your estimate, then <strong>Export</strong> a PDF or CSV.</li>
        </ol>
        <p class="small text-muted mb-0">Shortcuts you’ll use a lot: <kbd>Tab</kbd>/<kbd>Shift</kbd>+<kbd>Tab</kbd> to move between inputs;
           <kbd>Ctrl</kbd>/<kbd>Cmd</kbd>+<kbd>F</kbd> to find items.</p>
        <hr class="my-3">
        <div class="row g-2">
          <div class="col-6 col-md-3"><a href="#workflow" class="btn btn-outline-secondary w-100">Workflow</a></div>
          <div class="col-6 col-md-3"><a href="#libraries" class="btn btn-outline-secondary w-100">Libraries</a></div>
          <div class="col-6 col-md-3"><a href="#estimator" class="btn btn-outline-secondary w-100">Estimator</a></div>
          <div class="col-6 col-md-3"><a href="#summary" class="btn btn-outline-secondary w-100">Summary</a></div>
          <div class="col-6 col-md-3"><a href="#customers" class="btn btn-outline-secondary w-100">Customers</a></div>
          <div class="col-6 col-md-3"><a href="#settings" class="btn btn-outline-secondary w-100">Settings</a></div>
          <div class="col-6 col-md-3"><a href="#saving" class="btn btn-outline-secondary w-100">Save / Load</a></div>
          <div class="col-6 col-md-3"><a href="#exporting" class="btn btn-outline-secondary w-100">Exporting</a></div>
          <div class="col-6 col-md-3"><a href="#tips" class="btn btn-outline-secondary w-100">Tips</a></div>
          <div class="col-6 col-md-3"><a href="#troubleshooting" class="btn btn-outline-secondary w-100">Troubleshooting</a></div>
          <div class="col-6 col-md-3"><a href="#glossary" class="btn btn-outline-secondary w-100">Glossary</a></div>
          <div class="col-6 col-md-3"><a href="#whats-next" class="btn btn-outline-secondary w-100">What’s Next</a></div>
        </div>
      </div>
    </section>
  </div>

  <!-- Workflow -->
  <div class="col-12" id="workflow">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Recommended Workflow</h2>
        <ol class="mb-0">
          <li><strong>Set defaults first</strong> (Admin → Settings) so new estimates start with your rates, taxes, and margin.</li>
          <li><strong>Build the estimate</strong> (Estimator): add scoped line items, quantities, and any labor adjustments.</li>
          <li><strong>Review totals</strong> (Summary): verify labor hours, OH, DJE, margin, and taxes.</li>
          <li><strong>Save &amp; export</strong>: PDF for clients, CSV for your records/imports.</li>
          <li><strong>Tune libraries</strong>: when you create new line items more than once, add them to Libraries for re-use.</li>
        </ol>
      </div>
    </section>
  </div>

  <!-- Libraries -->
  <div class="col-12" id="libraries">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Libraries (Materials / DJE / Customers)</h2>
        <ul class="mb-0">
          <li><strong>Materials.</strong> Give each item a clear name, unit (ea, ft, m, roll), <em>Cost ea</em>, and <em>Labor Unit</em> (hours per unit). Keep descriptions concise and searchable (e.g., “EMT ¾″, 10′ stick”).</li>
          <li><strong>DJE (Direct Job Expense).</strong> Non-material costs (permits, equipment, fees, travel). Use a predictable naming scheme (“Permit – City of Tulsa,” “Lift – 45′, 2 days”).</li>
          <li><strong>Assemblies.</strong> Group commonly installed items into a single drop-in (e.g., “(4) duplex on EMT, ¾″, 100′”). Include typical hardware and an aggregate labor unit.</li>
          <li><strong>Customers.</strong> Store company name, contact, and address so you can tag estimates and export with the right identity.</li>
        </ul>
        <div class="text-muted small mt-2">Note: Data editing screens are design-complete stubs until wiring is enabled.</div>
      </div>
    </section>
  </div>

  <!-- Estimator -->
  <div class="col-12" id="estimator">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Estimator</h2>
        <ul class="mb-3">
          <li><strong>Row anatomy (Materials):</strong>
            <ul class="mb-2">
              <li><em>Notes</em> (free text scope)</li>
              <li><em>Material Type</em> (DB-driven) → Description fills from the library</li>
              <li><em>Qty</em> (number) • <em>Labor Adj</em> (×0.25, ×0.5, ×1, ×1.5, ×2)</li>
              <li><em>Cost ea</em> (read-only) → <em>Material Ext</em> = Qty × Cost ea</li>
              <li><em>Labor Unit</em> (read-only) → <em>Labor Hrs</em> = Qty × Labor Unit</li>
              <li><em>Unit</em> (ea, ft, etc.)</li>
            </ul>
          </li>
          <li><strong>Adjustments (Labor-Unit Adjustment):</strong> Apply a multiplier when warranted (height, tight access, premium schedule). Keep rationale in Notes.</li>
          <li><strong>DJE:</strong> Add non-material job expenses (permits, rentals, fees). DJE totals roll up on Summary.</li>
          <li><strong>Totals:</strong> Mat Total and Total Hrs update live in the header area.</li>
        </ul>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="bg-light rounded p-3 h-100">
              <div class="fw-semibold mb-1">Tips</div>
              <ul class="mb-0">
                <li>Make each line represent a measurable unit of work.</li>
                <li>Use <em>Notes</em> to capture assumptions (height, night work, off-hours).</li>
                <li>When in doubt, add a line for setup/cleanup or layout—small items reduce surprises.</li>
              </ul>
            </div>
          </div>
          <div class="col-md-6">
            <div class="bg-light rounded p-3 h-100">
              <div class="fw-semibold mb-1">Keyboard</div>
              <ul class="mb-0">
                <li><kbd>Tab</kbd> to move cells; <kbd>Shift</kbd> + <kbd>Tab</kbd> to go back.</li>
                <li><kbd>Enter</kbd> in Notes adds a new row (when supported).</li>
                <li><kbd>Esc</kbd> to cancel edits (when supported).</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Summary -->
  <div class="col-12" id="summary">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Summary</h2>
        <p class="mb-2">The Summary page rolls up:</p>
        <ul class="mb-3">
          <li><strong>Materials</strong> (costs, totals)</li>
          <li><strong>Labor</strong> (hours × rate) and any Labor Adjustments</li>
          <li><strong>DJE</strong> (non-material costs)</li>
          <li><strong>Overhead</strong>, <strong>Margin/Markup</strong>, and <strong>Tax</strong> (based on your Settings and estimate-level choices)</li>
        </ul>
        <p class="mb-1 fw-semibold">What you can do here</p>
        <ul class="mb-0">
          <li>Verify totals and adjust permitted fields (e.g., margin target).</li>
          <li>Confirm whether materials and/or DJE are taxable for this estimate.</li>
          <li>Check the final sell price before exporting.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Customers -->
  <div class="col-12" id="customers">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Customers</h2>
        <p class="mb-2">Select an existing customer when creating a new estimate.</p>
        <ul class="mb-0">
          <li>Add a new customer from the <strong>Customers</strong> page (and, if enabled, directly from the estimate form).</li>
          <li>Customer details are used for exports and future proposal features.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Settings -->
  <div class="col-12" id="settings">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Settings</h2>
        <p class="mb-2">Configure company identity (for proposals) and estimator defaults (labor rate, overhead, margin, taxes, etc.).</p>
        <ul class="mb-0">
          <li><strong>Company identity:</strong> name, address, contact details → used on exports and proposals.</li>
          <li><strong>Estimator defaults:</strong> labor rate, overhead %, margin/markup, tax behavior (prices are tax-exclusive).</li>
          <li><strong>Behavior:</strong> rounding, currency, materials taxable by default (on/off).</li>
        </ul>
        <div class="text-muted small mt-2">Save changes, then create a new estimate to apply updated defaults.</div>
      </div>
    </section>
  </div>

  <!-- Saving / Loading -->
  <div class="col-12" id="saving">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Saving &amp; Loading</h2>
        <ul class="mb-0">
          <li><strong>Save:</strong> Save an estimate any time; exports reflect the last saved state.</li>
          <li><strong>Open:</strong> Open saved estimates from <strong>Estimates → List</strong>.</li>
          <li><strong>Clone:</strong> Branch variations without changing the original.</li>
          <li><strong>Delete:</strong> Remove a test or stale estimate from the list.</li>
        </ul>
        <div class="text-muted small mt-2">Tip: After saving, use the <strong>Home → Recent Estimates</strong> card for quick access to your last few jobs.</div>
      </div>
    </section>
  </div>

  <!-- Exporting -->
  <div class="col-12" id="exporting">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Exporting</h2>
        <ul class="mb-3">
          <li><strong>PDF:</strong> A clean, client-ready summary with your branding, project info, and totals.</li>
          <li><strong>CSV:</strong> Line-level export (items, quantities, costs, labor units/hours, totals) for audit/import.</li>
        </ul>
        <p class="mb-1 fw-semibold">Checklist before export</p>
        <ul class="mb-0">
          <li>Save the estimate.</li>
          <li>Confirm Summary totals (labor, DJE, OH, margin, tax).</li>
          <li>Verify customer and project fields for the output header.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Tips -->
  <div class="col-12" id="tips">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Tips</h2>
        <ul class="mb-0">
          <li>Structure lines by scope so each row is easy to verify.</li>
          <li>Write assumptions in <em>Notes</em> to defend adjustments and conditions.</li>
          <li>Tune libraries over time—small improvements compound across jobs.</li>
          <li>Review Summary after big scope changes; adjust OH/Margin intentionally, not by accident.</li>
          <li>Keep your browser current; close heavy tabs when doing large edits.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Troubleshooting -->
  <div class="col-12" id="troubleshooting">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Troubleshooting</h2>
        <ul class="mb-0">
          <li><strong>Dropdowns look empty:</strong> Check Libraries for the item; refresh the page after adding.</li>
          <li><strong>Totals look wrong:</strong> Re-check Qty and Labor Adj, then visit Summary to confirm OH/Margin/Tax.</li>
          <li><strong>Export shows old values:</strong> Save the estimate, then export again.</li>
          <li><strong>A new estimate shows unexpected data:</strong> Start from <strong>Estimates → New Estimate</strong> (not by reusing a previously edited tab). If it persists, note the steps/time and email support.</li>
          <li><strong>Something feels slow or off:</strong> Hard-refresh your browser and try again; include browser/OS in any support email.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Glossary -->
  <div class="col-12" id="glossary">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">Glossary</h2>
        <dl class="mb-0">
          <dt>Labor Unit</dt>
          <dd>Hours to install one unit of an item.</dd>

          <dt>Labor Adjustment</dt>
          <dd>Multiplier reflecting conditions (e.g., ×1.5 for tight access).</dd>

          <dt>Overhead (OH)</dt>
          <dd>General business costs not tied to one job (office, insurance, trucks).</dd>

          <dt>Margin</dt>
          <dd>Target profit percentage after OH and direct costs.</dd>

          <dt>Markup</dt>
          <dd>Increase over cost to reach a sell price (related to, but not the same as, margin).</dd>

          <dt>DJE</dt>
          <dd>Direct Job Expense — non-material costs (permits, rentals, fees).</dd>

          <dt>Assembly</dt>
          <dd>A reusable bundle of materials/tasks with an aggregate labor unit.</dd>

          <dt>Material Type / Unit</dt>
          <dd>Item category (e.g., EMT) / measurement (ea, ft, m, roll).</dd>
        </dl>
      </div>
    </section>
  </div>

  <!-- What's Next -->
  <div class="col-12" id="whats-next">
    <section class="card">
      <div class="card-body">
        <h2 class="h5 mb-3">What’s Next</h2>
        <ul class="mb-0">
          <li>Proposal builder templates connected to Settings/Customers.</li>
          <li>Estimate versioning &amp; side-by-side compare.</li>
          <li>Additional export formats and options.</li>
        </ul>
        <div class="text-muted small mt-2">(Roadmap items are subject to change.)</div>
      </div>
    </section>
  </div>

</div>
{% endblock %}
