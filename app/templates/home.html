{% extends "base.html" %}
{% block title %}Home Â· Electrical Estimator{% endblock %}
{% block container_class %}container-xxl{% endblock %}

{% block content %}
<div class="home-sidebar-page row g-4">

  {% if not current_user.is_authenticated %}
    <!-- Logged-out CTA -->
    <section class="py-5 text-center w-100">
      <h1 class="display-6 fw-bold mb-2">Build fast, accurate estimates.</h1>
      <p class="text-muted mb-4">Start your 3-day trial.</p>
      <div class="d-flex gap-2 justify-content-center">
        <a class="btn btn-primary btn-lg rounded-pill" href="{{ url_for('main.pricing') }}">View pricing</a>
        <a class="btn btn-outline-secondary btn-lg rounded-pill" href="{{ url_for('auth.login_get') }}">Sign in</a>
      </div>
    </section>

  {% else %}
    <!-- Sidebar -->
    <aside class="col-12 col-lg-3">
      <div class="card p-2 sticky-sidebar">
        <div class="list-group list-group-flush">
          <button
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            data-bs-toggle="modal"
            data-bs-target="#newEstimateModeModal"
          >
            <span>âš¡</span> <span>Start New Estimate</span>
          </button>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('estimates.index') }}"
          >
            <span>ğŸ“</span> <span>Open / View Estimates</span>
          </a>

          <div class="list-group-item text-uppercase small text-muted">
            Libraries
          </div>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('libraries.materials') }}?rt=home"
          >
            <span>ğŸ§±</span> <span>Material List</span>
          </a>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('libraries.dje') }}?rt=home"
          >
            <span>ğŸ› ï¸</span> <span>DJE Items</span>
          </a>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('admin.list_assemblies') }}?rt=home"
          >
            <span>ğŸ§©</span> <span>Assemblies</span>
          </a>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('libraries.customers') }}"
          >
            <span>ğŸ‘¤</span> <span>Customers</span>
          </a>

          <div class="list-group-item text-uppercase small text-muted">
            System
          </div>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('admin.settings') }}"
          >
            <span>âš™ï¸</span> <span>Settings</span>
          </a>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('main.instructions') }}"
          >
            <span>ğŸ“˜</span> <span>Instructions</span>
          </a>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('main.faqs') }}"
          >
            <span>â“</span> <span>FAQs</span>
          </a>

          <a
            class="list-group-item list-group-item-action d-flex align-items-center gap-2"
            href="{{ url_for('main.whats_new') }}"
          >
            <span>ğŸ“°</span> <span>What's New</span>
          </a>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <main class="col-12 col-lg-9">
      <!-- Top strip -->
      <header class="home-header sticky text-center py-3 border-bottom">
        <h1 class="fw-bold mb-1 display-6">Welcome back</h1>
        <p class="text-muted mb-0 fs-6">
          Pick up where you left off or start something new.
        </p>
      </header>

      <!-- Tips (moved to top) -->
      <div class="card mt-4">
        <div class="card-header"><strong>Tips</strong></div>
        <div class="card-body">
          <ul class="mb-0">
            <li><strong>Review your Settings first:</strong> set company info, labor rate, overhead, and margin so new estimates start with the right numbers.</li>
            <li><strong>Use your starter libraries:</strong> Materials and DJE include a base setâ€”edit them to match your work.</li>
            <li><strong>Keep notes short and specific:</strong> clear notes make change orders faster later.</li>
            <li><strong>Check the Summary before export:</strong> quick scan for odd quantities or hours prevents misses.</li>
          </ul>
        </div>
      </div>

      <!-- Recent (visual only) -->
      <div class="card mt-4">
        <div class="card-header d-flex align-items-center justify-content-between">
          <strong>Recent Estimates</strong>
          <a class="link-secondary small" href="/estimates">View all</a>
        </div>
        <div class="table-responsive">
          <table id="recentEstimatesTable" class="table table-sm table-hover align-middle mb-0">
            <thead>
              <tr>
                <th>Estimate</th>
                <th>Customer</th>
                <th>Updated</th>
                <th class="text-end">Open</th>
              </tr>
            </thead>
            <tbody id="recentEstimatesBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Metrics Snapshot -->
      <div class="row g-3 mt-4">
        <div class="col-12 col-md-4">
          <div class="card stat-card h-100">
            <div class="card-body">
              <div class="stat-label text-muted">Estimates (coming soon)</div>
              <div class="stat-value">â€”</div>
              <div class="stat-sub text-muted">Total created</div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card stat-card h-100">
            <div class="card-body">
              <div class="stat-label text-muted">% Awarded (coming soon)</div>
              <div class="stat-value">â€”</div>
              <div class="stat-sub text-muted">Win rate</div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card stat-card h-100">
            <div class="card-body">
              <div class="stat-label text-muted">Avg Profit % (coming soon)</div>
              <div class="stat-value">â€”</div>
              <div class="stat-sub text-muted">Across awarded jobs</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Blog (coming soon) -->
      <div class="card mt-4">
        <div class="card-header d-flex align-items-center justify-content-between">
          <strong>From the Blog</strong>
          <span class="text-muted small">Coming soon</span>
        </div>
        <div class="list-group list-group-flush">
          <div class="list-group-item">
            <div class="fw-semibold">Set Your Estimating Defaults in 60 Seconds</div>
            <div class="text-muted small">The quick checklist for company info, labor rate, overhead, and margin â€” so every new estimate starts right.</div>
          </div>
          <div class="list-group-item">
            <div class="fw-semibold">Labor Units: Starting Points, Not Absolutes</div>
            <div class="text-muted small">How to adjust for job conditions (access, height, repetition, crew) without guessing.</div>
          </div>
          <div class="list-group-item">
            <div class="fw-semibold">DJE: The Costs That Sneak Up on Your Bid</div>
            <div class="text-muted small">Permits, equipment, and travel â€” when to include them and how to avoid surprises.</div>
          </div>
        </div>
      </div>
    </main>
  {% endif %}

</div> <!-- /.home-sidebar-page -->

{% if current_user.is_authenticated %}
<!-- Modal: New Estimate Mode (visual only) -->
<div class="modal fade" id="newEstimateModeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Start New Estimate</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted">Choose how you want to begin:</p>
        <div class="d-grid gap-3">
          <a class="btn btn-primary btn-lg" href="{{ url_for('estimates.new') }}">Standard Estimate</a>
          <a class="btn btn-outline-primary btn-lg" href="/estimator">Fast Estimate</a>
        </div>
        <div class="form-text mt-3">You can fill or change details later.</div>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% if current_user.is_authenticated and show_settings_nudge %}
<div class="modal fade" id="settingsNudgeModal" tabindex="-1" aria-hidden="true" data-auto-open="1">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Finish setting up your account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">Take 60 seconds to review your company info and defaults.</p>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary" href="{{ url_for('admin.settings') }}">Open Settings</a>
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Maybe later</button>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/home_index.js') }}"></script>
{% endblock %}
